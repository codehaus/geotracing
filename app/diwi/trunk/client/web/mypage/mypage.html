<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html>
<head>
<title>De Digitale Wichelroede</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"/>
<link rel="stylesheet" type="text/css" href="../css/mypagebasis.css">
<link rel="stylesheet" type="text/css" href="../css/maakroute.css">
<link rel="stylesheet" type="text/css" href="../css/mijnpagina.css">
<link rel="stylesheet" type="text/css" href="../css/winclassic.css">
<!-- <link rel="stylesheet" type="text/css" href="../css/lightbox.css"> -->
<script type="text/javascript" src="../lib/gt/DHTML.js"></script>
<script type="text/javascript" src="../lib/gt/KWClient.js"></script>
<script type="text/javascript" src="../js/KWClientDiWi.js"></script>
<script type="text/javascript" src="../js/KWClientCMS.js"></script>
<script type="text/javascript" src="../js/traces.js"></script>
<script type="text/javascript" src="../lib/openlayers/lib/OpenLayers.js"></script>
<script type="text/javascript" src="../lib/gt/Server.js"></script>
<script type="text/javascript" src="../lib/gt/Record.js"></script>
<!--- slider js --->
<script src="../js/range.js" type="text/javascript"></script>
<script src="../js/timer.js" type="text/javascript"></script>
<script src="../js/slider.js" type="text/javascript"></script>


<!-- slcr.js maakt de sliders... -->
<script type="text/javascript" src="../js/maakroute.js"></script>

<!-- Einde van alles wat op maakroutepagina getoond moet worden. ------------------------------------------>
<script type="text/javascript" src="../js/selectstartpage.js"></script>

<script type="text/javascript">

/************ De Session wordt uit een koekje gehaald... ********************/
var DIWI = {
// Initialization of KWClient library
	init: function() {
		DIWI.pr('init...');
		SRV.init();
		SRV.url = '/diwi/srv/get.jsp?';

		// KeyWorx client with
		// callbacks (2x)
		// server timeout in minutes
		// server root path /diwi
		KW.init(DIWI.onRsp, DIWI.onNegRsp, 100, '/diwi');

		// Try to restore and continue with saved session
		DIWI.pr('init done, restoring session');
		KW.restoreSession();
		document.getElementsByTagName("name")[0].innerHTML = KW.agentKey;
		DIWI.pr('restored session, key=' + KW.agentKey);

		DIWI.getStartPoints();
		DIWI.getEndPoints();
		DIWI.getThemes();

		DIWI.getTraces();

		DIWI.testUtopia();
		toonMaakRoutePagina();
	},

// test fun to see if session is really active
	testUtopia: function() {
		DIWI.pr('testUtopia start');

		// May use any request, here a common one: echo
		var req = KW.createRequest('echo-req');
		KW.post(DIWI.onRsp, req);
	},
	logout: function() {
		DIWI.pr('logout start');
		// KeyWorx client
		KW.logout();
		DIWI.pr('logout sent');
		return false;
	},
	getTraces: function() {
		var user = 'geoapp-user';
		SRV.get('q-tracks-by-user', DIWI.onTrackRsp, 'user', user);
	},
	getSelectedTrace: function(in_id) {
		var id = in_id;
		SRV.get('get-track', DIWI.onSelectedTrackRsp, 'id', id, 'format', 'gtx', 'attrs', 'lon,lat,t');
	},

	maakroutes: function() {
		DIWI.pr('maakroute start');
		var params = new Array();
		params[KW.DIWI.BESLOTEN_PARAM] = s1.getValue();
		params[KW.DIWI.HALFOPEN_PARAM] = s2.getValue();
		params[KW.DIWI.OPEN_PARAM] = s3.getValue();
		params[KW.DIWI.BEDRIJVEN_PARAM] = s4.getValue();
		params[KW.DIWI.BEWONING_PARAM] = s5.getValue();
		params[KW.DIWI.BOS_PARAM] = s6.getValue();
		params[KW.DIWI.HEIDE_PARAM] = s7.getValue();
		params[KW.DIWI.GRASLAND_PARAM] = s8.getValue();
		params[KW.DIWI.ZEE_PARAM] = s9.getValue();
		params[KW.DIWI.SLOTEN_PARAM] = s10.getValue();
		params[KW.DIWI.STARTPUNT_PARAM] = document.getElementById("startpunt").value;
		params[KW.DIWI.EINDPUNT_PARAM] = document.getElementById("eindpunt").value;
		params[KW.DIWI.THEMA_PARAM] = document.getElementById("thema").value;
		params[KW.DIWI.AFSTAND_PARAM] = document.getElementById("afstand").value;
		params[KW.DIWI.WANDELAAR_PARAM] = document.getElementById("wandelen").checked;

		KW.DIWI.generateroute(null, params);
	},

	getRoute: function(id) {
		KW.DIWI.getroute(DIWI.onRsp, id);
	},

	getMap: function(id, height, width) {
		KW.DIWI.getmap(DIWI.onMapRsp, id, width, height);
	},

	getStartPoints: function() {
		KW.CMS.getstartpoints(DIWI.onRsp);
	},

	getEndPoints: function() {
		KW.CMS.getendpoints(DIWI.onRsp);
	},

	getThemes: function() {
		KW.CMS.getthemes(DIWI.onRsp);
	},

	getActiveRoute: function() {
		KW.DIWI.getactiveroute(DIWI.inRsp);
	},

	getFixedRoutes: function() {
		KW.DIWI.getfixedroutes(DIWI.onRsp);
	},

	getBigMap: function() {
		KW.DIWI.getmap(DIWI.onMapRsp, currentGeneratedRouteId, 800, 800);
	},

	onMapRsp: function(elm) {
		if (!elm) {
			return;
		}
		verwerkPlaatje(elm);
		document.getElementById("maakroutebox").style.display = 'block';
		document.getElementById("leguitbox").style.display = 'none';
		document.getElementById("leguittext").style.display = 'none';
		document.getElementById("leguitbullet").style.display = 'none';
	},

	onTrackRsp: function(elm) {
		maakTracesForm(elm);
	},

	onSelectedTrackRsp: function(elm) {
		toonSelectedTrace(elm);
	},

	onRsp: function(elm) {
		if (!elm) {
			DIWI.pr('empty response');
			return;
		}

		DIWI.pr('got server response ' + elm.tagName);
		if (elm.tagName == 'person-getdefault-rsp') {
			DIWI.pr('person-getlist OK');
		} else if (elm.tagName == 'poi-get-startpoints-rsp') {
			maakStartpuntForm(elm);
		} else if (elm.tagName == 'poi-get-endpoints-rsp') {
			maakEindpuntForm(elm);
		} else if (elm.tagName == 'kich-get-themes-rsp') {
			maakThemasForm(elm);
		} else if (elm.tagName == 'poi-get-fixedroutes-rsp') {
			maakThemasForm(elm);
		} else if (elm.tagName == 'route-generate-rsp') {
			currentGeneratedRouteId = elm.firstChild.getAttribute('id');
			KW.DIWI.getmap(DIWI.onMapRsp, currentGeneratedRouteId, 150, 150);
			verwerkGenRoute(elm);
		}

		else {
			DIWI.pr('rsp tag=' + elm.tagName + ' ' + elm);
		}
		if (elm.tagName == 'logout-rsp') {
			DIWI.pr('logout OK');
			document.location.href = '../index.html?logged=false';
		}
		else {
			DIWI.pr('rsp tag=' + elm.tagName + ' ' + elm);
			DIWI.pr('xml content:<pre>' + DH.escape(elm.ownerDocument.xml) + '</pre>');
		}

	},

// KWClient negative response handler.
	onNegRsp: function(errorId, error, details) {
		DIWI.pr('negative resp:' + error + ' details=' + details);
	},

// Util for printing/displaying debug output
	pr: function (s) {
		DH.addHTML('result', '<br/>' + s);
	}

}


/*******************************************************************************/
var currentGeneratedRouteId = 0;
var currentSelection = 1;
var toolbarData = new Array();
toolbarData[1] = new Array('buttons/routes.jpg', 'buttons/routesH.jpg', 'buttons/routesH.jpg');
toolbarData[2] = new Array('buttons/home.jpg', 'buttons/homeH.jpg', 'buttons/homeH.jpg');
toolbarData[3] = new Array('buttons/mijnpagina.jpg', 'buttons/mijnpaginaH.jpg', 'buttons/mijnpaginaH.jpg');
toolbarData[4] = new Array('buttons/maakroute.jpg', 'buttons/maakrouteH.jpg', 'buttons/maakrouteH.jpg');
toolbarData[5] = new Array('buttons/uitloggen.jpg', 'buttons/uitloggenH.jpg', 'buttons/uitloggenH.jpg');

var buttons = 5;

var popupData = new Array("kaartpopup1", "kaartpopup2", "kaartpopup3", "kaartpopup4");

function highlightItem(obj, state) {
	i = obj.getAttribute('id');
	if (i != currentSelection) {
		obj.setAttribute('src', toolbarData[i][state]);
	}
}

function selectButton(obj) {
	i = obj.getAttribute('id');
	var tbar = new Array();
	for (j = 1; j < buttons + 1; j++) {
		tbar[j] = document.getElementById(j);
		if (tbar[j]) {
			tbar[j].setAttribute('src', toolbarData[(j)][0]);
		}
	}
	obj.setAttribute('src', toolbarData[i][2]);
	currentSelection = i;
}


function toonPlaatje(index) {
	im = document.getElementById(200);
	im.src = imageNames[index - 1];
}

function laadtPlaatjes() {
	var d = document;
	if (d.images) {
		if (!d.MM_p) {
			d.MM_p = new Array();
		}
		var i,j = d.MM_p.length,a = laadtPlaatjes.arguments;
		for (i = 0; i < a.length; i++) {
			if (a[i].indexOf("#") != 0) {
				d.MM_p[j] = new Image;
				d.MM_p[j++].src = a[i];
				j++;
			}
		}
	}
}

function hidePopup(d) {
	if (d.length < 1) {
		return;
	}
	DH.toggleDisplay(document.getElementById(popupData[d]));
}
function showPopup(d) {
	if (d.length < 1) {
		return;
	}
	DH.toggleDisplay(document.getElementById(popupData[d]));
}

function show(d) {
	for (i = 0; i < 4; i++) {
		if (i == d) {
			showPopup(i);
		} else {
			hidePopup(i);
		}
	}
}

// Call DIWI.init() when page is fully loaded
DH.addEvent(window, 'load', DIWI.init, false);
</script>

<!--<script type="text/javascript" src="../js/lightbox.js"></script>
<script type="text/javascript">
	initLightbox();
</script>     -->
</head>
<body>
<div id="logo"><a><img src="images/logot.jpg" border="0" onClick="location.href='../index.html?logged=true';"> </a>
</div>

<div id="line"><img src="images/line.jpg" border="0"/></div>

<div id="copyright"><img src="images/copyright.jpg" border="0"/></div>

<!-- <div id="butroutes">
	<a><img id="1" src="buttons/routes.jpg"onMouseOver="highlightItem(this, 1)"
		onMouseOut="highlightItem(this, 0)" onClick="selectButton(this);location.href='../index.html?routes=true';" border="0"></a>
</div> -->
<div id="buthome">
	<a><img id="2" src="buttons/home.jpg" onMouseOver="highlightItem(this, 1)"
			onMouseOut="highlightItem(this, 0)" onClick="location.href='../index.html?logged=true';" border="0"/></a>
</div>

<div id="butmijnpagina">
	<a><img id="3" src="buttons/mijnpagina.jpg" onMouseOver="highlightItem(this, 1)"
			onMouseOut="highlightItem(this, 0)" onClick="selectButton(this);toonMijnPagina();" border="0"/></a>
</div>

<div id="butmaakroute">
	<a><img id="4" src="buttons/maakroute.jpg" onMouseOver="highlightItem(this, 1)"
			onMouseOut="highlightItem(this, 0)" onClick="selectButton(this);toonMaakRoutePagina();" border="0"/></a>
</div>

<div id="butuitloggen">
	<a><img id="5" src="buttons/uitloggen.jpg" onMouseOver="highlightItem(this, 1)"
			onMouseOut="highlightItem(this, 0)" onClick="selectButton(this); javascript:DIWI.logout();" border="0"/></a>
</div>

<!-- Alles wat op mijnpagina getoond moet worden. ---------------------------------------------------->
<div id="mijnpaginacontainer" style="display:none;">
<div id="personaliabox"><img src="../media/images/videobox.gif" border="0"/></div>

<div id="bullet"><img src="buttons/bullet.gif" border="0"/></div>

<div id="commentaarbox"><img src="buttons/commentaarblok.gif" border="0"/></div>

<div id="commentaartekst">
	<H10>Opmerkingen over uw route:</H10>
	Was helemaal fijn!
	<p>
	</p>
</div>


<div id="commentaarEditbox" style='display:block'><img src="buttons/commentaarblok.gif" border="0"/></div>

<div id="commentaarEdittekst" style='display:block'>
	<H10>Opmerkingen over uw route:</H10>

	<textarea rows="5" cols="22">
	</textarea>
	<a href="" onClick="">Wijzig het commentaar</a>
</div>
<!--
-->
<div id="map">
</div>


<script type="text/javascript">

	var map, layer, popup;
	var markers = 'null';
	var feature, marker;

	map = new OpenLayers.Map('map');

	layer = new OpenLayers.Layer.WMS("OpenLayers WMS",
			"http://labs.metacarta.com/wms/vmap0", {layers: 'basic'});
	map.addLayer(layer);

	map.addControl(new OpenLayers.Control.LayerSwitcher());
	map.zoomToMaxExtent();

	var playing = false;
	function toggleButtonSrc() {
		if (playing == false) {
			document.getElementById('playbutton').setAttribute('src', 'buttons/speelstop_stop.gif');
			playing = true;
		} else {
			document.getElementById('playbutton').setAttribute('src', 'buttons/speelstop_play.gif');
			playing = false;
		}
	}
</script>

<div id="butspeelaf">
	<a><img id="playbutton" src="buttons/speelstop_play.gif" onclick="StartTheTimer();" border="0"></a>
</div>

<div id="butstop">
	<a><img id="stopbutton" src="buttons/speelstop_stop.gif" onclick="StopTheClock();" border="0"></a>
</div>

<div id="butwijzigprofiel">
	<!--		<a><img id="7" src="buttons/wijzigprofiel.jpg" border="0"></a> -->
</div>


<div id="butkiesroute">
	<!--			<form action="dummyvalue">
				<select name="newurl" onChange="">
					<option value="0" selected="selected">kies een van mijn routes</option>
					<option value="1" >bunkerholen</option>
					<option value="2" >heeel lang</option>
					<option value="3" disabled="disabled"> ---- Miscellaneous ----</option>
					<option value="4" >snert route</option>
				</select>
				</form> -->
</div>

<div id="paginaheader">
	<p>
		Mijn pagina<br>
	</p>
</div>

<div id="routeheader">
	<p>
		Ronde om de Grebbeberg
	</p>
</div>

<div id="author">
	<p>
		Kim Deal, gedaan op 23 februari 2007
	</p>
</div>

<div id="ookgelopen">
	<p>
		Deze route is ook gelopen door de volgende wandelaars: Jan Jansen, Piet Pietersen, Harry Visser.
	</p>
</div>

<div id="personaliatekst">
	<h11>
		Steve Albini <br>
	</h11>

	<p>
		<img src="images/self.jpg" border="0" align="left">
		Haai, mijn naam is <name>Steve Albini</name> en ik ben het meest bekend geworden als producer van de Pixies en
		natuurlijk Nirvana!
	</p>
</div>
</div>

<!-- Einde alles wat op mijnpagina getoond moet worden ----------------------------------------------------->


<!-- Alles wat op maakroutepagina getoond moet worden. ----------------------------------------------------->
<div class="pagina" id="maakroutecontainer" style="display:block;">

<div id="paginaheader">
	<p>
		Route samenstellen<br>
	</p>
</div>

<div id="radiobuttons" class="radiocaption">
	<input id="wandelen" name=rb1 type=radio onClick="selectWandelen()"> Wandelen
	<input id="fietsen" name=rb2 type=radio onClick="selectFietsen()"> Fietsen
</div>

<div class="listboxes" id="startpunt-lb">
</div>

<div class="listboxes" id="eindpunt-lb">
</div>

<div class="listboxes" id="thema-lb">
</div>

<div class="listboxes" id="afstand-lb">
</div>


<div class="slidercaption" id="caption1">
	Besloten agrarisch gebied
</div>

<div class="slider" id="slider1">
	<input class="slider-input" id="s1input"/>
</div>

<div class="slidertext" id="besloten">
	<input id="s1value" value="0" onChange="s1.setValue(parseInt(this.value))"/>%
</div>

<div class="slidercaption" id="caption2">
	Halfopen agrarisch gebied
</div>

<div class="slider" id="slider2">
	<input class="slider-input" id="s2input"/>
</div>

<div class="slidertext" id="halfopen">
	<input id="s2value" value="0" onChange="s2.setValue(parseInt(this.value))"/>%
</div>

<div class="slidercaption" id="caption3">
	Open agrarisch gebied
</div>

<div class="slider" id="slider3">
	<input class="slider-input" id="s3input"/>
</div>

<div class="slidertext" id="open">
	<input id="s3value" value="0" onChange="s3.setValue(parseInt(this.value))"/>%
</div>

<div class="slidercaption" id="caption4">
	Bedrijven en industrie
</div>

<div class="slider" id="slider4">
	<input class="slider-input" id="s4input"/>
</div>

<div class="slidertext" id="bedrijven">
	<input id="s4value" value="0" onChange="s4.setValue(parseInt(this.value))"/>%
</div>

<div class="slidercaption" id="caption5">
	Bewoningskernen
</div>

<div class="slider" id="slider5">
	<input class="slider-input" id="s5input"/>
</div>

<div class="slidertext" id="bewoning">
	<input id="s5value" value="0" onChange="s5.setValue(parseInt(this.value))"/>%
</div>

<div class="slidercaption" id="caption6">
	Bos
</div>

<div class="slider" id="slider6">
	<input class="slider-input" id="s6input"/>
</div>

<div class="slidertext" id="bos">
	<input id="s6value" value="0" onChange="s6.setValue(parseInt(this.value))"/>%
</div>

<div class="slidercaption" id="caption7">
	Heide zand en duingebied
</div>

<div class="slider" id="slider7">
	<input class="slider-input" id="s7input"/>
</div>

<div class="slidertext" id="heide">
	<input id="s7value" value="0" onChange="s7.setValue(parseInt(this.value))"/>%
</div>

<div class="slidercaption" id="caption8">
	Natuurlijk grasland, moeras <br>en riet
</div>

<div class="slider" id="slider8">
	<input class="slider-input" id="s8input"/>
</div>

<div class="slidertext" id="grasland">
	<input id="s8value" value="0" onChange="s8.setValue(parseInt(this.value))"/>%
</div>

<div class="slidercaption" id="caption9">
	Zee en grote meren
</div>

<div class="slider" id="slider9">
	<input class="slider-input" id="s9input"/>
</div>

<div class="slidertext" id="zee">
	<input id="s9value" value="0" onChange="s9.setValue(parseInt(this.value))"/>%
</div>

<div class="slidercaption" id="caption10">
	Sloten, beken, rivieren en <br>plassen
</div>

<div class="slider" id="slider10">
	<input class="slider-input" id="s10input"/>
</div>

<div class="slidertext" id="sloten">
	<input id="s10value" value="0" onChange="s10.setValue(parseInt(this.value))"/>%
</div>

<div id="butmaakeigenroute">
	<a><img src="buttons/maakroute-submit.gif" onMouseOver="" onMouseOut="" onClick="javascript:DIWI.maakroutes();" border="0"></a>
</div>

<div id="maakroutebox" style="display:none"><img src="buttons/maakrouteblokken.gif" border="0"></div>

<div id="leguitbox" style="display:block"><img src="../media/images/videobox.gif" border="0"></div>

<div id="leguitbullet" style="display:block"><img src="buttons/bullet.gif" border="0"></div>

<div id="leguittext" class="slidercaption" style="display:block">
	Stel uw eigen route samen naar uw eigen voorkeuren!
	Klik op "maakroute" en er wordt een zo nauwkeurig mogelijke route voor u gemaakt, geheel naar eigen wensen.
	Let wel op! Wanneer u een nieuwe route maakt, wordt de vorige overschreven.
</div>

<div id="generated-routes" class="genroutetekst"></div>

<div id="generated-routes-image"></div>

<div id="generated-routes-image-big"></div>

</div>

</body>


</html>
