// JavaScript Document		var tracesString = '<form><select id="traces_form" ><option value="0" selected="selected">kies een van mijn gedane routes</option>';	var traces_names = new Array();	var traces_id = new Array();	var n_traces = -1;		function maakTracesForm(elm) {		if (elm != null) {			n_traces = elm.length;			for(i=0;i<n_traces;i++){				tracesString += '<option value=' + elm[i].getField('id');				tracesString += ' onClick="DIWI.getSelectedTrace(' + elm[i].getField('id') + ') ">' + elm[i].getField('name');				tracesString += '</option>';			}			tracesString += '</select></form>';		}		var ni = document.getElementById('butkiesroute');		ni.innerHTML = tracesString;	}	 	var pt_lon_array;	var pt_lat_array;	var pt_time_array;		var media_name_array;	var media_mime_array;	var media_kind_array;	var media_lon_array;	var media_lat_array;	var media_time_array;	var time_array;		var total = 0;	var walker = 0;	var punt_list;	var time_list;	function toonSelectedTrace(elm) {	    total = walker = 0;		media_list = elm.getElementsByTagName('medium');		punt_list = elm.getElementsByTagName('pt');		time_array = new Array();		total = punt_list.length + media_list.length;		var media_counter = 0;		var punt_counter = 0;		// Maak een time array, gesorteerd op time, levert of er een punt of media getoond moet worden		// met daarnaast de index van de betreffeende arry		for (i=0;i<total; i++) {			if (media_counter == media_list.length) {				time_array[i] = new Array('p', punt_counter);				punt_counter++;			} else {				if (punt_counter == punt_list.length) {					time_arrray[i] = new Array('m', media_counter);					media_counter++;				} else {					if (media_list.item(media_counter).getAttribute('time') < punt_list.item(punt_counter).getAttribute('t')){						time_arrray[i] = new Array('m', media_counter);						media_counter++;					} else {						time_arrray[i] = new Array('p', punt_counter);						punt_counter++;					}				}			}		}				media_name_array = new Array();		media_mime_array = new Array();		media_kind_array = new Array();		media_lon_array = new Array();		media_lat_array = new Array();		media_time_array = new Array();		for(i=0;i<media_list.length;i++){			media_name_array[i] = media_list.item(i).getAttribute('name');			media_mime_array[i] = media_list.item(i).getAttribute('mime');			media_kind_array[i] = media_list.item(i).getAttribute('kind');			media_time_array[i] = media_list.item(i).getAttribute('time');			media_lon_array[i] = media_list.item(i).getAttribute('lon');			media_lat_arry[i] = media_list.item(i).getAttribute('lat');		}				pt_lon_array = new Array();		pt_lat_array = new Array();		pt_time_array = new Array();		var LAT=0;		var LON=0;		for(i=0;i<punt_list.length;i++){			pt_time_array[i] = punt_list.item(i).getAttribute('t'); 			pt_lon_array[i] = punt_list.item(i).getAttribute('lon');			LON += pt_lon_array[i]/punt_list.length;			pt_lat_array[i] = punt_list.item(i).getAttribute('lat');			LAT += pt_lat_array[i]/punt_list.length;		}		map.setCenter(new OpenLayers.LonLat( LON, LAT), 12, false);		LON = 0;		LAT = 0;//		StartTheTimer();	}		    var map, layer, popup;        var markers, feature, marker;		function changer() {            popup.setBackgroundColor("red");            popup.setSize(new OpenLayers.Size(100,600));            popup.setBorder("2px solid");                popup.setContentHTML("High Chickens");                    }        function add() {            popup = new OpenLayers.Popup("chicken", new OpenLayers.LonLat(5,40),new OpenLayers.Size(200,200),"example popup",true);            map.addPopup(popup);        }                function addAnchor() {            popup = new OpenLayers.Popup.Anchored("chicken", new OpenLayers.LonLat(5,40), new OpenLayers.Size(200,200),"example popup");            map.addPopup(popup);        }        ///////////////////////////////////////////////////////////////////////////////////////// Timer...///////////////////////////////////////////////////////////////////////////////////////		var secs=3;		var timerID = null;		var timerRunning = false;		var delay = 100;				function InitializeTimer()		{			// Set the length of the timer, in seconds			secs = 2;			walker = 0;			StopTheClock();			StartTheTimer();		}		function restartTimer() {			secs=5;			StopTheClock();			StartTheTimer();		}				function StopTheClock() {			if(timerRunning)				clearTimeout(timerID);			timerRunning = false;		}				function toggleTimer() {		  if (timerRunning == true) {		      StopTheClock();		  } else {		      StartTheTimer();		  }		}/****************************************************************************************	Deze stuurt de hele gehackte zwik aan...het is allemaal niet al te fraai....*****************************************************************************************/				function StartTheTimer() {			if (secs==0) {				if (walker<total) {					doDrawing();					walker++;					restartTimer();					} else {					StopTheClock();				}			} else {				self.status = secs				secs = secs - 1				timerRunning = true				timerID = self.setTimeout("StartTheTimer()", delay)			}		}				function doDrawing(){			if (time_array[walker][0]== 'p'){				addMarker(pt_lon_array[time_array[walker][1]], pt_lat_array[time_array[walker][1]]);							} else {				displayMedia(time_array[walker][1]);				//Display the media...									}					}		        function addMarker(lon, lat) {                markers = new OpenLayers.Layer.Markers("zibo");            map.addLayer(markers);            feature = new OpenLayers.Feature(layer, new OpenLayers.LonLat(lon,lat));            marker = feature.createMarker();            markers.addMarker(marker);            marker.events.register("mousedown", marker, mousedown);        }        				function displayMedia(j){		}          function mousedown(evt) {            if (popup == null) {                popup = feature.createPopup();                popup.setContentHTML("<a href='http://www.somethingconstructive.net' target='_blank'>click me</a>");                popup.setBackgroundColor("yellow");                popup.setOpacity(0.7);                markers.map.addPopup(popup);            } else {                markers.map.removePopup(popup);                popup.destroy();                popup = null;            }            Event.stop(evt);        }                /**         * @param {Event} evt         */        function onPopupMouseDown(evt) {            markers.map.removePopup(popup);            popup.destroy();            popup = null;            Event.stop(evt);        }        function destroy() {            popup.destroy();        }        function remove() {            markers.removeMarker(marker);        }                function removeMarkerLayer() {            if (marker == 'NULL') {            } else {                marker.destroy();            }        }        function removelayer() {            layer.destroy();//            map.removeLayer(markers);        }